<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinhala OCR Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ocr_server.css') }}">
    <script src="{{ url_for('static', filename='js/ocr_server.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

    <div class="ocr-header">
        <div class="container">
            <div class="flex items-center justify-between py-4">
                <div>
                    <h1 class="ocr-title">Sinhala OCR Dashboard</h1>
                    <p class="ocr-subtitle">Intelligent document processing with advanced text extraction</p>
                </div>
                <div class="text-sm text-muted">
                    <span id="currentTime"></span>
                </div>
            </div>
        </div>
    </div>

    <nav class="ocr-nav">
        <div class="container">
            <div class="ocr-nav-tabs">
                <button class="ocr-tab active" onclick="switchTab(event, 'process')">Document Processing</button>
                <button class="ocr-tab" onclick="switchTab(event, 'analytics')">Analytics</button>
                <button class="ocr-tab" onclick="switchTab(event, 'reports')">Reports</button>
                <button class="ocr-tab" onclick="switchTab(event, 'history')">Document History</button>
            </div>
        </div>
    </nav>

    <main class="ocr-content">
        <div id="process-tab" class="ocr-tab-content active">
            <div class="dashboard-grid">
                <div class="upload-section">
                    <h3 class="section-title">Document Upload</h3>
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">ðŸ“„</div>
                        <div class="upload-text">Click or drag document here</div>
                        <div class="upload-hint">Supports: JPG, PNG, PDF, TIFF â€¢ Sinhala & English text</div>
                    </div>
                    <input type="file" id="fileInput" class="file-input" accept=".jpg,.jpeg,.png,.pdf,.tiff,.tif" />
                    
                    <div id="previewContainer" style="display: none;">
                        <h4 style="margin: 20px 0 10px 0; color: var(--text-primary);">Document Preview:</h4>
                        <img id="previewImage" class="preview-image" />
                    </div>
                </div>

                <div class="controls-section">
                    <h3 class="section-title">Processing Controls</h3>
                    
                    <button class="button process" id="processBtn" onclick="processDocument()" disabled>
                        Process Document
                    </button>
                    
                    <button class="button speak" id="speakBtn" onclick="speakText()" disabled>
                        Text to Speech
                    </button>
                    
                    <button class="button clear" onclick="clearResults()">
                        Clear Results
                    </button>
                    
                    <h3 class="section-title" style="margin-top: 1.5rem;">System Status</h3>
                    <div id="status" class="status info">Ready for document processing</div>
                    
                    <div class="processing-indicator" id="processingIndicator">
                        <div class="loading-spinner"></div>
                        Processing document...
                    </div>
                </div>

                <div class="camera-section">
                    <h3 class="section-title">Camera Feed</h3>
                    <div class="camera-container" id="cameraContainer">
                        <img id="cameraPreview" alt="Camera feed" style="display: none;" />
                        <div class="empty-state" id="cameraPlaceholder">
                            <h3>Camera Not Active</h3>
                            <p>Start camera to see live feed</p>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="button process" id="startCameraBtn" onclick="startCamera()">
                            Start Camera
                        </button>
                        <button class="button clear" id="stopCameraBtn" onclick="stopCamera()" disabled>
                            Stop Camera
                        </button>
                        <button class="button speak" id="captureBtn" onclick="captureFromCamera()" disabled>
                            Capture Frame
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="results-section">
                <h3 class="section-title">Extraction Results</h3>
                
                <div id="documentInfo" style="display: none;">
                    <div class="document-info">
                        <strong>Document Type:</strong> <span id="docType" class="document-type"></span><br>
                        <strong>Classification Confidence:</strong> <span id="classificationConf"></span>%<br>
                        <strong>OCR Confidence:</strong> <span id="ocrConf"></span>% â€¢ 
                        <strong>Quality Score:</strong> <span id="qualityScore"></span>% â€¢ 
                        <strong>Processing Time:</strong> <span id="procTime"></span>ms
                        
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceBar"></div>
                        </div>
                    </div>
                </div>
                
                <div class="text-output" id="extractedText">
                    Extracted text will appear here after processing...
                </div>
            </div>
        </div>
        
        <div id="analytics-tab" class="ocr-tab-content">
            <div class="analytics-grid">
                <div class="stat-card documents-card">
                    <h4>Total Documents</h4>
                    <div class="stat-value" id="totalDocs">0</div>
                    <div class="stat-label">Processed</div>
                </div>
                <div class="stat-card success-card">
                    <h4>OCR Success Rate</h4>
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">Text Extraction</div>
                </div>
                <div class="stat-card identification-card">
                    <h4>Document ID Rate</h4>
                    <div class="stat-value" id="identificationRate">0%</div>
                    <div class="stat-label">Type Classification</div>
                </div>
                <div class="stat-card time-card">
                    <h4>Avg Time</h4>
                    <div class="stat-value" id="avgTime">0ms</div>
                    <div class="stat-label">Processing Time</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 class="section-title">Document Type Distribution</h3>
                <div id="docTypeChart" class="card p-4">
                    <div class="text-muted">Chart will be displayed here</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 class="section-title">Processing Performance</h3>
                <div id="performanceChart" class="card p-4">
                    <div class="text-muted">Chart will be displayed here</div>
                </div>
            </div>

            <div class="chart-container">
                <h3 class="section-title">Quality Analysis</h3>
                <div id="qualityChart" class="card p-4">
                    <div class="text-muted">Chart will be displayed here</div>
                </div>
            </div>
        </div>
        
        <div id="reports-tab" class="ocr-tab-content">
            <div class="report-section">
                <div class="report-header">
                    <h2>Daily Processing Report</h2>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <input type="date" id="reportDate" class="date-picker" onchange="loadDailyReport()" />
                        <button class="btn btn-primary" onclick="generateTestData()">
                            Generate Test Data
                        </button>
                    </div>
                </div>
                
                <div id="reportContent" class="card p-4">
                    <div class="text-muted">Select a date to view the daily report</div>
                </div>
            </div>
            
            <div class="report-section">
                <h3 class="section-title">Processing Logs</h3>
                <div id="processingLogs" class="card p-4">
                    <div class="text-muted">Processing logs will appear here</div>
                </div>
            </div>
            
            <div class="report-section">
                <h3 class="section-title">Historical Performance (Last 7 Days)</h3>
                <div id="historicalData" class="card p-4">
                    <div class="text-muted">Historical performance data will appear here</div>
                </div>
            </div>
        </div>
        
        <div id="history-tab" class="ocr-tab-content">
            <div class="results-section">
                <h3 class="section-title">Recent Documents</h3>
                <div class="recent-documents" id="recentDocuments">
                    <div class="card p-4">
                        <div class="text-muted">Document history will appear here</div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>
</html>